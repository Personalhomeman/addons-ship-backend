format_version: "7"
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git
project_type: other
app:
  envs:
  - DB_HOST: postgres
  - DB_NAME: addons_ship_dev
  - DB_USER: postgres
  - DB_PWD: postgres
workflows:
  up:
    steps:
    - script@1.1.5:
        title: Start server
        inputs:
        - content: |
            #!/bin/bash
            set -ex
            docker-compose up
  setup:
    steps:
    - script@1.1.5:
        title: Setup server
        inputs:
        - content: |
            #!/bin/bash
            set -ex
            docker-compose rm -f
            docker-compose build
            docker-compose up --no-start
            docker-compose start db
            docker-compose run --rm db sleep 1
            docker-compose exec db psql -U $DB_USER -c "drop database if exists $DB_NAME;"
            docker-compose exec db psql -U $DB_USER -c "create database $DB_NAME;"
